define(["jquery","json!tinymce_config","tinymce"],function(u,l){"use strict";if("undefined"==typeof tinymce)throw"Tinymce is not available.";tinymce.baseURL=l.tinymce_url,tinymce.suffix=".min",u(document).on("focusin",function(t){u(t.target).closest(".mce-window").length&&t.stopImmediatePropagation()}),u("form").on("submit",function(){tinymce.EditorManager.triggerSave()});var t,m=[];if("object"==typeof l.external_plugins)for(var n in l.external_plugins)l.external_plugins.hasOwnProperty(n)&&((t=l.external_plugins[n].url||null)&&(m.push({id:n,url:t}),tinymce.PluginManager.load(n,t)));return{init:function(t){setTimeout(function(){t.each(function(){var t=u(this),n=t.attr("id"),e=tinymce.get(n);if(!e){var i=t.data("theme")||"simple",o=void 0!==l.theme[i]?l.theme[i]:l.theme.simple;o.external_plugins=o.external_plugins||{};for(var a=0;a<m.length;a++)o.external_plugins[m[a].id]=m[a].url;var c,r=t.data("config")||{};for(c in r)o[c]=r[c];""===t.attr("id")&&t.attr("id","tinymce_"+Math.random().toString(36).substr(2)),o.setup=function(e){if("object"==typeof l.tinymce_buttons)for(var t in l.tinymce_buttons)l.tinymce_buttons.hasOwnProperty(t)&&!function(n,t){t.onclick=function(){var t=window["tinymce_button_"+n];"function"==typeof t?t(e):alert('You have to create callback function: "tinymce_button_'+n+'"')},e.addButton(n,t)}(t,clone(l.tinymce_buttons[t]));e.on("init",function(){var t;l.use_callback_tinymce_init&&("function"==typeof(t=window.callback_tinymce_init)?t(e):alert("You have to create callback function: callback_tinymce_init")),u(e.getElement()).prop("required",!1)}),e.on("blur",function(){e.save()})},e=new tinymce.Editor(n,o,tinymce.EditorManager)}e.render()})},150)},destroy:function(t){t.each(function(){var t=tinymce.get(u(this).attr("id"));t&&t.remove()})},save:function(t){t.each(function(){var t=tinymce.get(u(this).attr("id"));t&&t.save()})}}});