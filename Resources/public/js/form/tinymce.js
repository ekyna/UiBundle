define(["jquery","json!tinymce_config","tinymce"],function(a,b){"use strict";if("undefined"==typeof tinymce)throw"Tinymce is not available.";tinymce.baseURL=b.tinymce_url,tinymce.suffix=".min",a(document).on("focusin",function(b){a(b.target).closest(".mce-window").length&&b.stopImmediatePropagation()}),a("form").on("submit",function(){tinymce.EditorManager.triggerSave()});var c=[];if("object"==typeof b.external_plugins)for(var d in b.external_plugins)if(b.external_plugins.hasOwnProperty(d)){var e=b.external_plugins[d],f=e.url||null;f&&(c.push({id:d,url:f}),tinymce.PluginManager.load(d,f))}return{init:function(d){setTimeout(function(){d.each(function(){var d,e=a(this),f=e.attr("id");if(d=tinymce.get(f),!d){var g=e.data("theme")||"simple",h="undefined"!=typeof b.theme[g]?b.theme[g]:b.theme.simple;h.external_plugins=h.external_plugins||{};for(var i=0;i<c.length;i++)h.external_plugins[c[i].id]=c[i].url;var j=e.data("config")||{};for(var k in j)h[k]=j[k];""===e.attr("id")&&e.attr("id","tinymce_"+Math.random().toString(36).substr(2)),h.setup=function(c){if("object"==typeof b.tinymce_buttons)for(var d in b.tinymce_buttons)b.tinymce_buttons.hasOwnProperty(d)&&!function(a,b){b.onclick=function(){var b=window["tinymce_button_"+a];"function"==typeof b?b(c):alert('You have to create callback function: "tinymce_button_'+a+'"')},c.addButton(a,b)}(d,clone(b.tinymce_buttons[d]));c.on("init",function(){if(b.use_callback_tinymce_init){var d=window.callback_tinymce_init;"function"==typeof d?d(c):alert("You have to create callback function: callback_tinymce_init")}a(c.getElement()).prop("required",!1)}),c.on("blur",function(){c.save()})},d=new tinymce.Editor(f,h,tinymce.EditorManager)}d.render()})},150)},destroy:function(b){b.each(function(){var b=tinymce.get(a(this).attr("id"));b&&b.remove()})},save:function(b){b.each(function(){var b=tinymce.get(a(this).attr("id"));b&&b.save()})}}});